<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>喜好瓶</title>
    <style>

* {
	margin: 0;
	padding: 0;
	
}
html {
	background-color: #f0f0f0;
}
body {
	width: 100%;
	height: 100vh;
	max-width: 400px;
	margin: 0 auto;
	background-color: #ffffff;
	font-family: Arial, sans-serif;
	overflow-x: hidden;
	position: relative;
}

.buttons {
    position: absolute;
    top: 10px;
    right: 10px;
    display: inline-block;
    gap: 10px;
}

.buttons svg {
    cursor: pointer;
    width: 25px;
    height: 25px;
    fill: #555;
    transition: fill 0.3s ease;
}

.buttons svg:hover {
    fill: #000;
}

.input-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 150px;
    width: 100%;
}

.input-box {
    margin-bottom: 20px;
    text-align: center;
}

#inputData {
    width: 250px;
    height: 45px;  
    resize: none; 
    box-sizing: border-box;
    outline: none;
    padding: 10px;
    font-size: 14px;
    transition: height 0.3s ease;
    user-select: text;
	border-radius: 4px;
}
#inputData::placeholder {
    user-select: none;
}
#startButton {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 4px;
    background-color: grey;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#startButton:hover {
    background-color: black;
    color:white;
}


.container, .bottle-container {
    display: flex;
    flex-wrap: wrap; 
    justify-content: center; 
    align-items: flex-start; 
    gap: 10px; 
	  padding-top: 50px;
}


.bottle-wrapper {
    text-align: center;
    width: 90px; 
    min-width: 90px;  
    height: 80px;
    margin-bottom: 20px;
    margin-right: 0px; 
    border-radius: 10px;
    box-sizing: border-box;
}

.hidden {
    display: none;
}

.label {
	user-select: none;
}

#settingsModal {
	user-select: none;
	display: none; 
	position: fixed;
	top: -300px;
	left: 50%;
	transform: translateX(-50%);
	width: 300px;
	min-height: 200px;
	background-color: #fff;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
	padding: 20px;
	box-sizing: border-box;
	z-index: 1000; 
	border-radius: 15px; 
	opacity: 0; 
	transition: top 0.5s ease, opacity 0.5s ease; 
}

#settingsModal .modal-header {
	text-align: center;
	font-size: 16px;
	font-weight: bold;
	margin-bottom: 20px;
}

#settingsModal .modal-content {
	font-size: 14px;
}


#overlay {
	display: none; 
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
	z-index: 999; 
}

    </style>
</head>
<body>

    <div id="overlay"></div>

    <div id="settingsModal">
        <div class="modal-header">Setting</div>
        <div class="modal-content">

            后期做一些设置项。
        </div>
    </div>
	
<div class="buttons">

    <svg id="settingsButton" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/>
    </svg>

    <svg id="editButton" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-pencil-square hidden" viewBox="0 0 16 16">
        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
    </svg>
</div>

<div class="input-wrapper">
    <div class="input-box">
        <textarea type="text" id="inputData" placeholder="输入数据，用空格分隔"></textarea>
    </div>
    <button id="startButton">开始生成瓶子</button>
</div>

<div class="container bottle-container" id="bottleContainer"></div>

<script>
 const inputWrapper = document.querySelector('.input-wrapper');
const bottleContainer = document.getElementById('bottleContainer');
const startButton = document.getElementById('startButton');
const inputData = document.getElementById('inputData');

const settingsButton = document.getElementById('settingsButton');
const editButton = document.getElementById('editButton');

const settingsModal = document.getElementById('settingsModal');
        const overlay = document.getElementById('overlay');

        // 点击设置按钮时，显示弹窗并触发动画
        settingsButton.addEventListener('click', () => {
            settingsModal.style.display = 'block'; // 显示弹窗
            overlay.style.display = 'block'; // 显示遮罩
            document.body.style.overflow = 'hidden'; // 禁用页面滚动

            // 动画效果：从底部滑入，淡入
            setTimeout(() => {
                settingsModal.style.top = '50px'; // 移动到指定位置
                settingsModal.style.opacity = 1;   // 设置为不透明
            }, 10); // 延迟执行，确保样式变更生效
        });

        // 点击遮罩时，隐藏弹窗并触发动画
        overlay.addEventListener('click', () => {
            settingsModal.style.top = '-300px';  // 向下移动，消失
            settingsModal.style.opacity = 0;     // 设置为透明
            // 隐藏遮罩层
            setTimeout(() => {
                settingsModal.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto'; // 恢复页面滚动
            }, 500); // 动画持续500ms后隐藏
        });

inputData.addEventListener('input', () => {
	console.log(1);
    inputData.style.height = '45px';
    
    // 设置高度为内容的高度 + padding (考虑到上/下 padding)

    inputData.style.height =   `${Math.max(inputData.scrollHeight, 45)}px`;
});


startButton.addEventListener("click", () => {
    const inputText = inputData.value.trim();
    if (inputText) {
        const labels = inputText.split(/\s+/);
        bottleContainer.innerHTML = ''; // 清空之前的瓶子
        labels.forEach(label => createBottle(label));

        inputWrapper.style.display = 'none';
        bottleContainer.style.display = 'flex';
        editButton.classList.remove('hidden');
    } else {
        alert("请输入有效的数据！");
    }
});
 editButton.addEventListener("click", () => {
        const labels = Array.from(bottleContainer.querySelectorAll('.label')).map(label => label.textContent);
        inputData.value = labels.join(' ');
        bottleContainer.style.display = 'none';
        inputWrapper.style.display = 'flex';
        editButton.classList.add('hidden');
    });
function createBottle(labelText) {
    const wrapper = document.createElement("div");
    wrapper.classList.add("bottle-wrapper");

    const canvas = document.createElement("canvas");
    const scale = 0.3;
    const padding = 10 * scale;
    canvas.width = (60 + padding * 2) * scale;
    canvas.height = (180 + padding * 2) * scale;
    wrapper.appendChild(canvas);

    const label = document.createElement("div");
    label.classList.add("label");
    label.textContent = labelText;
    wrapper.appendChild(label);

    bottleContainer.appendChild(wrapper);

    const ctx = canvas.getContext("2d");
    let fillLevel = 0;
    const maxLevel = 8;
    const waterHeightPerLevel = 17.5 * scale;
    let currentWaterHeight = 0;

    function drawBottle() {
        const bottleWidth = 60 * scale;
        const bottleHeight = 180 * scale;
        const offset = 2 * scale;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "#333";
        ctx.lineWidth = 2 * scale;
        ctx.beginPath();
        ctx.moveTo(offset, offset);
        ctx.lineTo(offset, bottleHeight - 40 * scale + offset);
        ctx.quadraticCurveTo(offset, bottleHeight + offset, 20 * scale + offset, bottleHeight + offset);
        ctx.lineTo(40 * scale + offset, bottleHeight + offset);
        ctx.quadraticCurveTo(60 * scale + offset, bottleHeight + offset, 60 * scale + offset, bottleHeight - 40 * scale + offset);
        ctx.lineTo(60 * scale + offset, offset);
        ctx.stroke();

        if (currentWaterHeight > 0) {
            ctx.fillStyle = "#4dabf7";
            ctx.beginPath();
            ctx.moveTo(offset, bottleHeight - 40 * scale - currentWaterHeight + offset);
            ctx.lineTo(offset, bottleHeight - 40 * scale + offset);
            ctx.quadraticCurveTo(offset, bottleHeight + offset, 20 * scale + offset, bottleHeight + offset);
            ctx.lineTo(40 * scale + offset, bottleHeight + offset);
            ctx.quadraticCurveTo(60 * scale + offset, bottleHeight + offset, 60 * scale + offset, bottleHeight - 40 * scale + offset);
            ctx.lineTo(60 * scale + offset, bottleHeight - 40 * scale - currentWaterHeight + offset);
            ctx.closePath();
            ctx.fill();
        }
    }

    function animateFillLevel() {
        const targetWaterHeight = fillLevel * waterHeightPerLevel;
        const animationSpeed = 0.5;

        function step() {
            if (Math.abs(currentWaterHeight - targetWaterHeight) < animationSpeed) {
                currentWaterHeight = targetWaterHeight;
            } else if (currentWaterHeight < targetWaterHeight) {
                currentWaterHeight += animationSpeed;
            } else {
                currentWaterHeight -= animationSpeed * 10;
            }

            drawBottle();

            if (currentWaterHeight !== targetWaterHeight) {
                requestAnimationFrame(step);
            }
        }

        step();
    }

    canvas.addEventListener("click", function () {
        if (fillLevel < maxLevel) {
            fillLevel++;
        } else {
            fillLevel = 0;
        }
        animateFillLevel();
    });

    drawBottle();
}

</script>
</body>
</html>
