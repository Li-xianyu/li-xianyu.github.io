<!-- ====== index.htmlï¼ˆæ•´ä»½æ›¿æ¢ï¼‰====== -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>spé£è¡Œæ£‹</title>

	<!-- bootstrap-iconsï¼ˆä½ æƒ³å¹²å‡€ç‚¹å°±åˆ æ‰è¿™è¡Œä¹Ÿè¡Œï¼‰ -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css">

	<link rel="stylesheet" href="css/index.css">
</head>
<body>
	<div class="menu-container">
		<h1 class="game-title">SpankFlyingChess</h1>
		<div class="menu-buttons">
			<button class="menu-btn" id="startGame">ğŸ® å¼€å§‹æ¸¸æˆ</button>
			<button class="menu-btn" id="gameSettings">âš™ï¸ æ¸¸æˆè®¾ç½®</button>
			<button class="menu-btn" id="gameManual">ğŸ“– ä½¿ç”¨é¡»çŸ¥</button>
		</div>
	</div>

	<script src="js/ui.js"></script>
	<script src="js/Data.js"></script>

	<script>
"use strict";

/* ========= å…è´£å£°æ˜å¼¹çª—ï¼šæ ‡é¢˜å›ºå®š / å†…å®¹æ»šåŠ¨ / åº•éƒ¨æŒ‰é’®å›ºå®š ========= */
function createManualDialog(){
	const overlay = document.createElement('div');
	overlay.className = 'punishment-overlay';

	const dialog = document.createElement('div');
	dialog.className = 'punishment-dialog';

	// å¤´
	const title = document.createElement('h3');
	title.className = 'punishment-title';
	title.textContent = 'å…è´£å£°æ˜ä¸ä½¿ç”¨æ¡æ¬¾';

	// ä¸­é—´æ»šåŠ¨åŒº
	const content = document.createElement('div');
	content.className = 'punishment-content';
	content.innerHTML = `
		<div class="legal-disclaimer">
			1. æœ¬ç¨‹åºä»…é™å¹´æ»¡18å‘¨å²ä¸”å…·å®Œå…¨æ°‘äº‹è¡Œä¸ºèƒ½åŠ›çš„ç”¨æˆ·ä½¿ç”¨ã€‚æœªæˆå¹´äººåŠä¸å…·å¤‡å®Œå…¨æ°‘äº‹è¡Œä¸ºèƒ½åŠ›è€…ç¦æ­¢ä½¿ç”¨æœ¬ç¨‹åºã€‚<br><br>

			2. æœ¬ç¨‹åºä¸ºè™šæ‹Ÿå¨±ä¹äº§å“ï¼Œæ‰€åŒ…å«çš„æƒ…èŠ‚ã€ä»»åŠ¡ä¸äº’åŠ¨è®¾è®¡å‡ä¸ºè™šæ„åˆ›ä½œå†…å®¹ï¼Œä¸æ„æˆå¯¹ä»»ä½•ç°å®è¡Œä¸ºçš„å€¡å¯¼æˆ–ä»·å€¼å¯¼å‘ã€‚<br><br>

			3. æ‰€æœ‰äº’åŠ¨è¡Œä¸ºåº”å»ºç«‹åœ¨æˆå¹´äººä¹‹é—´è‡ªæ„¿ã€å¹³ç­‰ã€å……åˆ†çŸ¥æƒ…ä¸åˆæ³•çš„å‰æä¸‹ã€‚ç”¨æˆ·éœ€å¯¹è‡ªèº«è¡Œä¸ºæ‰¿æ‹…å…¨éƒ¨æ³•å¾‹è´£ä»»ã€‚å› ç”¨æˆ·çº¿ä¸‹è¡Œä¸ºæ‰€äº§ç”Ÿçš„ä»»ä½•çº çº·ã€æŸå®³æˆ–æ³•å¾‹åæœï¼Œå‡ç”±è¡Œä¸ºäººè‡ªè¡Œæ‰¿æ‹…ï¼Œå¼€å‘è€…ä¸æ‰¿æ‹…ä»»ä½•è¿å¸¦è´£ä»»ã€‚<br><br>

			4. ç”¨æˆ·ç”Ÿæˆå†…å®¹é¡»ç¬¦åˆç›¸å…³æ³•å¾‹æ³•è§„åŠå…¬åºè‰¯ä¿—è¦æ±‚ã€‚ç¦æ­¢å‘å¸ƒæ¶‰åŠè¿æ³•ã€æš´åŠ›ã€æ­§è§†æˆ–éæ³•æ´»åŠ¨çš„ä¿¡æ¯ã€‚å¼€å‘è€…ä¿ç•™å¯¹è¿è§„å†…å®¹è¿›è¡Œå®¡æ ¸ã€åˆ é™¤åŠé™åˆ¶è®¿é—®çš„æƒåˆ©ã€‚<br><br>

			5. éšç§ä¿æŠ¤æ¡æ¬¾ï¼šæœ¬ç¨‹åºä¸å‘æœåŠ¡å™¨ä¸Šä¼ ä»»ä½•ä¸ªäººæ•°æ®ï¼Œæ‰€æœ‰è®¾ç½®ä¸è¡Œä¸ºæ•°æ®ä»…å­˜å‚¨äºç”¨æˆ·æœ¬åœ°æµè§ˆå™¨ã€‚æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æ•°æ®å³å¯åˆ é™¤ç›¸å…³ä¿¡æ¯ã€‚<br><br>

			6. æœ¬ç¨‹åºåŠå…¶ç›¸å…³å†…å®¹çš„è‘—ä½œæƒå½’å¼€å‘è€…æ‰€æœ‰ã€‚æœªç»è®¸å¯ï¼Œä¸å¾—ä»¥ä»»ä½•å½¢å¼å¤åˆ¶ã€ä¼ æ’­æˆ–ç”¨äºå•†ä¸šç”¨é€”ã€‚<br><br>

			7. å¼€å‘è€…ä¿ç•™å› æ³•å¾‹è¦æ±‚ã€æ”¿ç­–è°ƒæ•´æˆ–å…¶ä»–åˆç†åŸå› éšæ—¶ä¿®æ”¹æ¡æ¬¾æˆ–ç»ˆæ­¢æœåŠ¡çš„æƒåˆ©ã€‚<br><br>

			ç»§ç»­ä½¿ç”¨æœ¬ç¨‹åºå³è¡¨ç¤ºæ‚¨å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„ä»¥ä¸Šå…¨éƒ¨æ¡æ¬¾ã€‚
		</div>
	`;

	// åº•éƒ¨æŒ‰é’®åŒº
	const buttonContainer = document.createElement('div');
	buttonContainer.className = 'dialog-buttons';

	const confirmBtn = document.createElement('button');
	confirmBtn.className = 'punishment-button';
	confirmBtn.id = 'confirmRestart';
	confirmBtn.textContent = 'åŒæ„å¹¶ç»§ç»­';

	const cancelBtn = document.createElement('button');
	cancelBtn.className = 'punishment-button';
	cancelBtn.id = 'cancelRestart';
	cancelBtn.textContent = 'æ‹’ç»å¹¶é€€å‡º';

	buttonContainer.append(confirmBtn, cancelBtn);
	dialog.append(title, content, buttonContainer);
	overlay.appendChild(dialog);

	const handleConfirm = () => {
		localStorage.setItem('manualAgreed','true');
		overlay.remove();
		confirmBtn.removeEventListener('click', handleConfirm);
		cancelBtn.removeEventListener('click', handleCancel);
	};

	const handleCancel = () => {
		confirmBtn.removeEventListener('click', handleConfirm);
		cancelBtn.removeEventListener('click', handleCancel);

		clearPageContent();

		try{
			window.open('', '_self').close();
			if (window.history.length > 1) window.close();
			else window.location.href = 'about:blank';
		}catch(e){
			document.querySelectorAll('*').forEach(n => n.remove());
		}

		setTimeout(() => window.location.replace('about:blank'), 3000);
	};

	confirmBtn.addEventListener('click', handleConfirm);
	cancelBtn.addEventListener('click', handleCancel);

	// ç‚¹é®ç½©ä¸å…³ï¼ŒåªæŠ–ä¸€ä¸‹æç¤º
	overlay.addEventListener('click', (e) => {
		if (e.target === overlay){
			confirmBtn.style.animation = 'shake 0.5s';
			setTimeout(() => confirmBtn.style.animation = '', 500);
		}
	});

	return overlay;
}

/* ========= æ¸…å±é€€å‡º ========= */
function clearPageContent(){
	localStorage.clear();
	sessionStorage.clear();

	try{
		if (indexedDB && indexedDB.databases){
			indexedDB.databases().then(dbs => {
				dbs.forEach(db => indexedDB.deleteDatabase(db.name));
			});
		}
	}catch(e){}

	document.documentElement.style.overflow = 'hidden';
	while(document.body.firstChild){
		document.body.removeChild(document.body.firstChild);
	}

	const exitOverlay = document.createElement('div');
	exitOverlay.innerHTML = `
		<div class="exit-overlay">
			<div class="exit-message">
				<h3>å·²ç»ˆæ­¢è®¿é—®</h3>
				<p>å·²ç»æ¸…é™¤é¡µé¢...</p>
			</div>
		</div>
	`;
	document.body.appendChild(exitOverlay);

	document.body.style.pointerEvents = 'none';
	window.onbeforeunload = null;
	window.stop();
}

/* ========= æ£‹ç›˜ / æ¨¡å¼ ========= */
function getMaxGrid(board){
	return Math.max(...board.flat(2).filter(n => n > 0));
}

function createBoardDialog(){
	const overlay = document.createElement('div');
	overlay.className = 'punishment-overlay';

	const dialog = document.createElement('div');
	dialog.className = 'board-dialog';

	const title = document.createElement('h3');
	title.className = 'punishment-title';
	title.textContent = 'é€‰æ‹©æ£‹ç›˜';

	const listContainer = document.createElement('div');
	listContainer.className = 'board-list';

	Boards.forEach((board, index) => {
		const item = document.createElement('div');
		item.className = 'board-item';
		item.innerHTML = `
			<div class="board-info">
				<div class="board-name">${boardNames[index].name}</div>
				<div class="board-desc">${boardNames[index].desc}</div>
			</div>
			<div class="board-size">${getMaxGrid(board)}æ ¼</div>
		`;

		item.addEventListener('click', () => {
			overlay.remove();
			document.body.appendChild(createModeDialog(index + 1));
		});

		listContainer.appendChild(item);
	});

	const cancelBtn = document.createElement('button');
	cancelBtn.className = 'punishment-button';
	cancelBtn.textContent = 'å–æ¶ˆé€‰æ‹©';
	cancelBtn.addEventListener('click', () => overlay.remove());

	const footer = document.createElement('div');
	footer.className = 'dialog-buttons';
	footer.appendChild(cancelBtn);

	dialog.append(title, listContainer, footer);
	overlay.appendChild(dialog);

	overlay.addEventListener('click', (e) => {
		if (e.target === overlay){
			cancelBtn.style.animation = 'shake 0.5s';
			setTimeout(() => cancelBtn.style.animation = '', 500);
		}
	});

	return overlay;
}

function createModeDialog(boardId){
	const overlay = document.createElement('div');
	overlay.className = 'punishment-overlay';

	const dialog = document.createElement('div');
	dialog.className = 'board-dialog';

	const title = document.createElement('h3');
	title.className = 'punishment-title';
	title.textContent = 'é€‰æ‹©æ¨¡å¼';

	const listContainer = document.createElement('div');
	listContainer.className = 'board-list';

	const modes = [
		{ key:'solo', name:'å•äººæ¨¡å¼', desc:'åªæŠ•ã€Œè¢«ã€çš„ä¸€å¥—ä»»åŠ¡ï¼ˆçº¯æƒ©ç½šæ£‹ç›˜ï¼‰' },
		{ key:'dual', name:'åŒäººæ¨¡å¼', desc:'ä¸»/è¢«éƒ½æŠ•ï¼Œå„èµ°å„çš„æ ¼å­ï¼ˆä¸¤å¥—ä»»åŠ¡ï¼‰' }
	];

	modes.forEach(m => {
		const item = document.createElement('div');
		item.className = 'board-item';
		item.innerHTML = `
			<div class="board-info">
				<div class="board-name">${m.name}</div>
				<div class="board-desc">${m.desc}</div>
			</div>
			<div class="board-size">${m.key}</div>
		`;

		item.addEventListener('click', () => {
			window.location.href = `game.html?id=${encodeURIComponent(boardId)}&mode=${encodeURIComponent(m.key)}`;
		});

		listContainer.appendChild(item);
	});

	const backBtn = document.createElement('button');
	backBtn.className = 'punishment-button';
	backBtn.textContent = 'è¿”å›é‡é€‰æ£‹ç›˜';
	backBtn.addEventListener('click', () => {
		overlay.remove();
		document.body.appendChild(createBoardDialog());
	});

	const footer = document.createElement('div');
	footer.className = 'dialog-buttons';
	footer.appendChild(backBtn);

	dialog.append(title, listContainer, footer);
	overlay.appendChild(dialog);

	return overlay;
}

/* ========= å¯åŠ¨ ========= */
document.addEventListener('DOMContentLoaded', () => {
	// é¦–æ¬¡è‡ªåŠ¨å¼¹å…è´£å£°æ˜
	if (!localStorage.getItem('manualAgreed')){
		document.body.appendChild(createManualDialog());
	}else{
		console.log('ç”¨æˆ·å·²åŒæ„é¡»çŸ¥');
	}

	// æ‰‹åŠ¨æ‰“å¼€å…è´£å£°æ˜
	document.getElementById('gameManual').addEventListener('click', () => {
		document.body.appendChild(createManualDialog());
	});

	// å¼€å§‹æ¸¸æˆï¼šå…ˆæ£‹ç›˜åæ¨¡å¼
	document.getElementById('startGame').addEventListener('click', () => {
		document.body.appendChild(createBoardDialog());
	});

	// è®¾ç½®é¡µ
	document.getElementById('gameSettings').addEventListener('click', () => {
		window.open('setting.html','_blank');
	});
});
	</script>
</body>
</html>